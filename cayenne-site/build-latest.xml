<?xml version="1.0"?>

<!-- ================================================= -->
<!-- Latest release buildfile. Called from build.xml. -->
<!-- ================================================= -->
<project default="site">

	<property name="dtd" value="${cayenne.latest}/src/cayenne/dtd"/>
	<property name="license" value="${cayenne.latest}/doc/licenses"/>
	<property name="grammar" value="${cayenne.latest}/dist/cayenne-${cayenne.latest.version}/doc/grammar"/>
    
    <!-- ============================================= -->
    <!-- Deploys Cayenne web site locally -->
    <!-- ============================================= -->
    <target name="site" depends="subproject,other-resources"/>
    
    <target name="other-resources" depends="check-latest,subproject">
    	<copy todir="${dist}/dtd">
    		<fileset dir="${dtd}" includes="**/*.dtd"/>
    	</copy>
    	<copy todir="${dist}/licenses">
    		<fileset dir="${license}" includes="**/**"/>
    	</copy>
    	<copy todir="${dist}/grammar">
    		<fileset dir="${grammar}" includes="**/*.html"/>
    	</copy>
    </target>
    
	<!-- ============================================= -->
    <!-- Assembles all documents related to the latest Cayenne. -->
    <!-- ============================================= -->
	<target name="subproject" depends="check-latest">
    	<ant antfile="build-subproject.xml" target="site">
    		<property name="cayenne.location" value="${cayenne.latest}"/>
    		<property name="subproject.dist" value="${cayenne.latest}/dist/cayenne-${cayenne.latest.version}"/>
    		<property name="subproject.name" value="cayenne-latest"/>
    		<property name="doc.include" value="userguide/**,modelerguide/**,examples/**,developerguide/**"/>
    		<property name="doc.root" value="${dist}"/>
    	</ant>
    </target>
    
    <target name="check-latest">
    	<available file="${cayenne.latest}" property="cayenne.latest.present"/>
    	<fail unless="cayenne.latest.present">
    	
**** FATAL: No valid Cayenne checkout. "cayenne.latest" property: "${cayenne.latest}"
    	</fail>
    </target>
</project>
