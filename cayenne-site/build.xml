<?xml version="1.0"?>

<!-- ================================================= -->
<!-- Cayenne Site master build file. -->
<!-- Serves as a facade to a set of private buildfiles. -->
<!-- ================================================= -->
<project default="site">

    <!-- ============================================= -->
    <!-- Loads properties from default locations. -->
    <!-- ============================================= -->
    <property file="build.properties" />
    <property file="${user.home}/build.properties" />
    <property file="default.properties" />
    
    
    <!-- ============================================= -->
    <!-- Derived Properties. These properties are -->
    <!-- derived from other properties. You probably -->
    <!-- don't want to redefine them. -->
    <!-- ============================================= -->
    <property name="dist" value="${dist.base}/${project.name}-${project.version}"/>


    <!-- ============================================= -->
    <!-- Prints help message describing build.xml use. -->
    <!-- ============================================= -->
    <target name="help">
        <echo>
     ******************************************************
     * Available targets (you can also use the "-projecthelp" ant flag 
     * to see targets):
     *
     *  1. site			- (default) creates Cayenne website
     *  2. help        - prints this message
     *  3. clean		- cleans the build
     *
     *
     * ENVIRONMENT:
     *  java.home = ${java.home}
     *  user.home = ${user.home}
     *  ant.home = ${ant.home}
     ******************************************************
         </echo>
    </target>
    
	<!-- ============================================= -->
    <!-- Prepare to build, define tasks. -->
    <!-- ============================================= -->
    <target name="prepare" >
    	<tstamp/>
    	
		<taskdef name="anakia" classname="org.apache.velocity.anakia.AnakiaTask">
			<classpath>
				<pathelement path="${ant.home}/lib/ant.jar"/>
				<fileset dir="${lib.dir}">
					<include name="**.jar"/>
			</fileset>
			</classpath>
        </taskdef>
    </target>

    <!-- ============================================= -->
    <!-- Deploys Cayenne web site locally -->
    <!-- ============================================= -->
    <target name="site" depends="prepare">
		<ant antfile="build-latest.xml" target="site"/>
		<!-- ant antfile="build-stable.xml" target="site"/ -->
		<ant antfile="build-site.xml" target="site"/>
		
		<!-- assemble -->
		<copy todir="${dist}">
			<fileset dir="${build}/cayenne-site/out"  includes="**/*.html"/>
			<fileset dir="${build}/cayenne-latest/out"  includes="**/*.html"/>
			<!-- fileset dir="${build}/cayenne-stable/out"  includes="**/*.html"/ -->
             
			<filterset begintoken="&lt;!--@" endtoken="@--&gt;">
				<filter token="SFLOGO" value="${sf.logo}"/>
			</filterset>
			<filterset begintoken="&lt;!--@" endtoken="@--&gt;">
				<filter token="JNLOGO" value="${java.net.logo}"/>
			</filterset>
		</copy>
    </target>
 
    <!-- ========================================== -->
    <!-- Cleans distribution files and subprojects. -->
    <!-- ========================================== -->
    <target name="clean">
        <delete dir="${dist.base}"/>
        <delete dir="${build}"/>
        <delete file="velocity.log"/>
    </target>
</project>


