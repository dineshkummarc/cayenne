<document>
<title>User Guide - Deployment</title>
<toc name="toc-user-guide" chapter="12. Deployment"  subchapter="12.2 Web Applications"/>
<body>
     <section name="12. Deployment">      
           <subsection name="12.2 Web Applications" anchor="web">
               <subsection name="12.2.4 Servlet 2.3 Filter">
			<p>This configuration approach is based on setting up a WebApplicationContextFilter as a Filter for some request URL pattern. 
				On each request session DataContext is rebound to the request worker thread, and can be 
					obtained via DataContext.getThreadDataContext().
					This approach allows to remove any Servlet API dependencies from the context retrieval code, and 
					also allows to control which request URLs will get a DataContext.</p>
				<table>
				<tr>
					<th>Servlet Spec. Compatibility:</th>
					<td>Version 2.3 and newer</td>
				</tr>
				<tr>
					<th>Participating classes:</th>
					<td>org.objectstyle.cayenne.conf.WebApplicationContextFilter</td>
				</tr>
				<tr>
					<th>Allows cayenne.xml in WEB-INF/:</th>
					<td>Yes</td>
				</tr>
				<tr>
					<th>Session-bound DataContext:</th>
					<td>Yes</td>
				</tr>
				<tr>
					<th>Request thread-bound DataContext:</th>
					<td>Yes</td>
				</tr>
				</table>

<p>Sample <code>web.xml</code> snippet with filter and filter-mapping elements: </p>      
<source>
&amp;lt;filter&amp;gt;
    &amp;lt;filter-name&amp;gt;CayenneFilter&amp;lt;/filter-name&amp;gt;
    &amp;lt;filter-class&amp;gt;org.objectstyle.cayenne.conf.WebApplicationContextFilter&amp;lt;/filter-class&amp;gt;
&amp;lt;/filter&gt;
...
&amp;lt;filter-mapping&amp;gt;
    &amp;lt;filter-name&amp;gt;CayenneFilter&amp;lt;/filter-name&amp;gt;
    &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
&amp;lt;/filter-mapping&amp;gt;
</source>
<p>Sample DataContext retrieval code: </p>  
<source>
import org.objectstyle.cayenne.access.DataContext;
...
// get session DataContext bound to the current request thread
DataContext context = DataContext.getThreadDataContext();
</source>
		</subsection>
</subsection>    
    </section>
</body>
</document>
