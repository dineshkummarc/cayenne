<document>
<title>User Guide - Quick Start</title>
    <properties>
        <author>Andrei Adamchik</author>
    </properties>
<navigator>
	<up>/userguide/index.html</up>
	<prev>/userguide/quickstart/comline.html</prev>
       <next>/userguide/quickstart/tapestrywebapp.html</next>
</navigator> 
<body>
    <section name="3. Quick Start">
       <subsection name="3.2 &quot;JSP/Struts Web Application&quot; Tutorial">
               <p>This section shows how to write and a deploy a jsp web application
    	using Cayenne.</p>
    	
   	    <panel name="Note:">
    		Full tutorial source code is included in Cayenne distribution in "src/tutorials" folder.
    	</panel>
    	
    	<panel name="Note:">
    		Configuration given in this tutorial assumes Servlet 2.3 compatible
    		container. For older containers, move cayenne files from WEB-INF to WEB-INF/classes
    		(e.g. "mv cayenne.xml datanode.driver.xml datamap.map.xml classes/") and remove listener
    		section from the web.xml.
    	</panel>

   	<p>Tutorial steps:</p>
    	
    	<ul>
    		<li><a href="#1">Tutorial Setup.</a></li>
    		<li><a href="#2">Prepare Tutorial Database.</a></li>
    		<li><a href="#3">Setup Cayenne Configuration Files.</a></li>
    		<li><a href="#4">Create Database Primary Key Support.</a></li>
    		<li><a href="#5">Generate Java Code for DataObjects.</a></li>
    		<li><a href="#6">Compile and Deploy the Application.</a></li>
    	</ul>
    	
               <subsection name="3.2.1 Tutorial Setup" anchor="1">
       		<p>- Follow the steps outlined in <a href="../install/index.html">Cayenne 
       		installation instructions</a>. In particular, JSDK 1.4 must be installed.
       		</p>
       		
       		<p>- Install a web container. This tutorial was tested with <a href=
    		"http://jakarta.apache.org/tomcat/index.html">Tomcat</a> version 4.1.10.
       		It should work with any other container that is compliant with Servlet 2.3
       		specification (older containers will also work, but you will not be able
       		to use some of ServletConfiguration features discussed below). 
       		All references to Tomcat below should apply in some form to other web containers
       		as well.</p>
    		
    		<p>- Use tutorial source directory distributed with Cayenne at
    		<code>$CAYENNE_HOME/src/tutorials/cayenne-web-app</code> 
    		as a project directory.</p>
    		
    		<p>- Copy <code>cayenne.jar</code> to the <code>WEB-INF/lib</code> subdirectory of 
    		the tutorial project directory.</p>
    		
    		<p> - Doublecheck the JDBC driver installation for the target database. If you haven't installed
    		it already, you may copy the driver jar file to 
       		<code>WEB-INF/lib</code> subdirectory of the tutorial project. Alternatively if you want it to be 
       		shared by all web applications and you are using Tomcat, you may copy it to
       		<code>$CATALINA_HOME/common/lib</code> instead.
       		</p>
       		
    		<p>- Install Struts: 
    		<ul>
    		<li>Download Struts from <a href=
    		"http://jakarta.apache.org/struts/index.html">Jakarta Struts site</a>, unpack it
    		to any convenient directory.</li> 
    		
    		<li>Copy all JAR files distributed with Struts (located in <code>lib</code> subdirectory) to
    		<code>WEB-INF/lib</code> subdirectory of the tutorial project.</li>
    		
    		<li>Copy all the *.tld files and validator-rules.xml from Struts 
    		<code>lib</code> subdirectory 
    		to <code>WEB-INF</code> subdirectory of the tutorial project.
			
    		</li>
    		</ul>
    		
    		Tutorial was testsed with Struts 1.1rc1, other versions of Struts may
    		require a different setup.</p>
    	</subsection>
    	
       <subsection name="3.2.2 Prepare Tutorial Database" anchor="2">
    		<p>Run <a href="../../tutorials/cayenne-web-app/tutorialdb.sql"><code>tutorialdb.sql</code></a>
    		script located in the project directory to create test tables. 
    		This script is tested on MySQL, but it should be easy to port to any other RDBMS. Also
    		note that if you already tried "Command Line Application" tutorial in
    		this chapter, you may already have tables with the same names in your database.
    		In this case you may uncomment "DROP TABLE..." statements in the beginning
    		of this script to recreate tables from scratch.</p>
    	</subsection>
    	
       <subsection name="3.2.3 Setup Cayenne Configuration Files" anchor="3">
    		<p>Configuration files included in this tutorial are:
    		
    		<ul>
    			<li><a href="../../tutorials/cayenne-web-app/WEB-INF/cayenne.xml">cayenne.xml</a></li>
    			<li><a href="../../tutorials/cayenne-web-app/WEB-INF/datamap.map.xml">datamap.map.xml</a></li>
    			<li><a href="../../tutorials/cayenne-web-app/WEB-INF/datanode.driver.xml">datanode.driver.xml</a></li>
    		</ul>
    		
    		Save these files under WEB-INF subdirectory of the tutorial project folder. Open <code>cayenne.xml</code> 
    		file in CayenneModeler and make the following changes:
    		<ul>
    			<li>if the database used is NOT MySQL, <code>cayenne.xml</code>
    			must be modified to use an adapter for the appropriate database.</li>
    			<li><code>driverinfo.xml</code> must be modified to reflect connection and
    			driver information of the test database.</li>
    		</ul>         	
    		</p>
    	    <img src="/images/tutorial-cfg-node.gif" width="639" height="503" border="0" align="middle"
			alt="Configure Node Panel"/>
    	</subsection>
    	
    	
       <subsection name="3.2.4 Create Database Primary Key Support." anchor="4">
    	<p>Open <code>cayenne.xml</code> in CayenneModeler and generate needed database
    	objects for primary key support by following these  
    	<a href="../../modelerguide/pksupport.html">instructions</a>. Skip this step if it was already 
    	done for another tutorial.</p>
    	</subsection>
    	
       <subsection name="3.2.5 Generate Java Code for DataObjects" anchor="5">
    		<p>Open <code>cayenne.xml</code> in CayenneModeler and generate Java classes 
    		for DataObjects by going to <strong>"Tools -> Generate Classes"</strong> 
    		and selecting the <strong><code>WEB-INF/classes</code></strong> under the tutorial 
    		project directory in the opened popup:</p>
    		<img src="/images/classgen.gif" width="546" height="489" border="0" align="middle"
			alt="Generate Classes Dialog"/>
			
    		<p>Click <strong>"Generate"</strong> button. After the generation 
    		is done, the following files should appear in the 
    		<code><code>WEB-INF/classes/test</code></code> subdirectory of the 
    		project directory:
    		
    		<ul>
    			<li><a href="../../tutorials/cayenne-web-app/WEB-INF/classes/webtest/_Artist.java">_Artist.java</a></li>
    			<li><a href="../../tutorials/cayenne-web-app/WEB-INF/classes/webtest/Artist.java">Artist.java</a></li>
    			<li><a href="../../tutorials/cayenne-web-app/WEB-INF/classes/webtest/_Painting.java">_Painting.java</a></li>
    			<li><a href="../../tutorials/cayenne-web-app/WEB-INF/classes/webtest/Painting.java">Painting.java</a></li>
    			<li><a href="../../tutorials/cayenne-web-app/WEB-INF/classes/webtest/_Gallery.java">_Gallery.java</a></li>
    			<li><a href="../../tutorials/cayenne-web-app/WEB-INF/classes/webtest/Gallery.java">Gallery.java</a></li>
    		</ul>
    		</p>    	
    	</subsection>
               <subsection name="3.2.6 Compile and Deploy the Application" anchor="6">
    		<p>Compile the source code like you would normally compile a webapplication.
    		The example is given for javac from the command line (assuming that JAVA_HOME variable 
    		points to the JDK 1.3 or 1.4 installation). Substitute <code>[servlet.jar]</code> 
    		with the path to the actiual JAR file,
    		for instance tomcat/common/lib/servlet.jar
    		On Windows:</p>
<source>
cayenne-web-app> cd WEB-INF\classes
cayenne-web-app\WEB-INF\classes> set CLASSPATH=%CLASSPATH%;[servlet.jar] 
cayenne-web-app\WEB-INF\classes> set CLASSPATH=%CLASSPATH%;..\lib\struts.jar;..\lib\cayenne.jar
cayenne-web-app\WEB-INF\classes> %JAVA_HOME%\bin\javac webtest\*.java formbean\*.java action\*.java
</source>

    		<p>On UNIX:</p>
<source>
cayenne-web-app# cd WEB-INF/classes
cayenne-web-app# export CLASSPATH=$CLASSPATH:[servlet.jar]:../lib/struts.jar:../lib/cayenne.jar
cayenne-web-app# $JAVA_HOME/bin/javac webtest/*.java formbean/*.java action/*.java
</source>

			<p>To deploy, simply copy <code>cayenne-web-app</code> directory to Tomcat 
			<code>webapps</code> directory and restart the Tomcat. URL of the new applications
			is <a href=
			"http://localhost:8080/cayenne-web-app/">http://localhost:8080/cayenne-web-app/</a>
			(on containers other then Tomcat, this will be different).
			</p>
    	</subsection>
    	</subsection>
    </section>
</body>
</document>
