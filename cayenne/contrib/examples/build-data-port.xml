<?xml version="1.0"?>

<!-- ========================================== -->
<!-- Core Cayenne subproject buildfile.         -->
<!-- ========================================== -->
<project name="data-port" default="compile">
	<property name="data-port.build" value="build/data-port"/>

	<!-- ========================================== -->
    <!-- Build targets.                             -->
    <!-- ========================================== -->
	
    <target name="api">
		<ant antfile="build-subproj.xml" target="api">
			<property name="subproj" value="data-port"/>
		</ant>
	</target>

	<target name="compile" depends="check-deps,failed-deps">
		<ant antfile="build-subproj.xml" target="compile">
			<property name="subproj" value="data-port"/>
		</ant>
	</target>
	
	<target name="dist-src" depends="dist-bin,api"> 
	    <copy todir="${dist}/src/data-port">
        	<fileset dir="data-port/src/java">
                <include name="**/*.java"/>
            </fileset>
        </copy>
	</target>
	
	<target name="dist-bin" depends="jar"/>
  
    <!-- ========================================== -->
    <!-- Build "fat" JAR file with dependencies.    -->
    <!-- ========================================== -->
    <target name="jar" depends="compile">
        <jar jarfile="${dist}/data-port/lib/data-port.jar">
 			<fileset dir="${data-port.build}/classes"/>
 			
            <metainf dir="${root}/doc/licenses" includes="**"/>
            <manifest>
               <attribute name="Built-By" value="${user.name}"/>
               <attribute name="Extension-Name" value="org.objectstyle.cayenne"/>
               <attribute name="Specification-Version" value="${project.name}"/>
               <attribute name="Specification-Vendor" value="ObjectStyle.org"/>
               <attribute name="Implementation-Vendor-Id" value="org.objectstyle"/>
               <attribute name="Implementation-Version" value="${project.version}"/>
               <attribute name="Implementation-Vendor" value="ObjectStyle.org"/>
            </manifest>
        </jar>
    </target>	
 
    <target name="check-deps">
		<available classname="org.objectstyle.cayenne.DataObject"
		           classpath="${cayenne.dir}/${cayenne.jar}"
		           ignoresystemclasses="true"
		           property="core.deps.exist"
		           value="No Cayenne classes found."/>
    </target>
    
    <target name="failed-deps" if="data-port.deps.fail">
		<fail message="Failed dependency check: ${data-port.deps.fail}"/>
    </target>
</project>
